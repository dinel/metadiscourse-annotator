{# empty Twig template #}

{% extends 'base.html.twig' %}

{% form_theme form _self %}

{% block _sense_score_widget %}
    <label for="polarity">Default polarity:</label>
    <input type="text" size="2" id="polarity" readonly style="border:0; background-color: #f5f5f5; ">
    <div style="display: inline-block; padding-left: 2em;" id="slider"></div>
    <input style="display:none;" type="text" id="sense-score" name="sense[score]">
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
    <link href="{{ asset('css/general.css') }}" rel="stylesheet">
    <link href="{{ asset('css/spectrum.css') }}" rel="stylesheet">
    
    <style>
        .ui-slider .ui-slider-handle {
            height: 15px;
            width: 5px;
            padding-left: 5px; 
        }

        .ui-slider-horizontal {
            height: 8px;
            width: 200px;
        }
        
        li.sense a {
            color: inherit;
        }
    </style>
{% endblock stylesheets %}

{% block body %}
    <div class="container">
        <div class="row voffset5"> 
            <div class="col-md-8">
                <strong>Metadiscourse marker:</strong> {{ mark.text }}<br/>
                <strong>Description:</strong> {{ mark.description }} <br/>
                <strong>Domains:</strong>
                {% for domain in mark.domains %}
                    {{ domain.name }}
                    {% if not loop.last %}
                        ,
                    {% endif %}
                {% endfor %}                
            </div>
        </div>
        
        <div class="row voffset2">
            <div class="col-md-8">
                {% if mark.senses[0].definition %}               
                    <strong>Current senses:</strong> 
                    <ol>
                    {% for sense in mark.senses %}
                        {% if sense.definition %}
                            <li class="sense"><span style="color:{{ sense.fgcolor}};background-color:{{ sense.bgcolor}};">
                                    <a href="{{ path('admin_sense_edit', {'id_marker': mark.id, 'id_sense': sense.id}) }}">{{ sense.definition }}</a>
                                </span>: {{ sense.explanation }} (Default score: {{ sense.score }}
                                {% if sense.categories | length > 0 %}
                                    , Default category: {{ sense.categories[0].name }}
                                {% endif %}
                                )
                            </li>
                        {% endif %}
                    {% endfor %}
                    </ol>
                {% else %}
                    <strong>There are no senses yet!</strong>
                {% endif %}
            </div>
        </div>        
            
        <hr width="75%" align="center"/>
        
        <h3>{{ message }}</h3>
        
        <div class="row voffset3">
            <div class="col-md-8">
                {{ form_start(form) }}
                {{ form_row(form.definition) }}
                {{ form_widget(form.score) }}                
                {{ form_end(form) }}
                {% if delete_button == 1 %}
                    <div><a href="{{ path('admin_sense_delete', {'id_marker': mark.id, 'id_sense': initial_sense.id}) }}" class="btn btn-default confirmation">Delete this sense (use with great care!!!)</a></div>
                {% endif %}
                <div id="preview" class="voffset2">Preview</div>
            </div>
        </div>
        <div class="row voffset2">
            <div class="col-md-8">
                <a href=" {{ path('admin_page') }} ">Back to admin</a>
            </div>
        </div>
    </div>            
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('js/spectrum.js') }}"></script>
    <script src="https://code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
    <script>
        $("#sense_bgColor").val('{{ initial_sense.bgcolor }}');
        $("#sense_bgColor").spectrum({
            color: "{{ initial_sense.bgcolor }}",
            preferredFormat: 'hex',
            clickoutFiresChange: true, 
            change: function(color) {
                $("#preview").css('background-color', color.toHexString());
            }
        });
                
        $("#sense_fgColor").val('{{ initial_sense.fgcolor }}');
        $("#sense_fgColor").spectrum({
            color: "{{ initial_sense.fgcolor }}",
            preferredFormat: 'hex',
            clickoutFiresChange: true, 
            change: function(color) {
                $("#preview").css('color', color.toHexString());
            }
        });
    
        $(function() {
            $( "#slider" ).slider({
                value: {{ initial_sense.score }},
                min: -5,
                max: 5,
                step: 1,
                slide: function( event, ui ) {
                    $( "#polarity" ).val( ui.value );
                    $( "#sense-score" ).val( ui.value );
                }
            });
            $( "#polarity" ).val( $( "#slider" ).slider( "value" ) );
            $( "#sense-score").val( $( "#slider" ).slider( "value" ) );
        });
        
        $("#preview").css('background-color', "{{ initial_sense.bgcolor }}");
        $("#preview").css('color', "{{ initial_sense.fgcolor }}");
        
        $('.confirmation').on('click', function () {
            return confirm('Are you sure you want to delete the sense? As a result you will also remove annotation that uses this sense. The operation is permanent.');
        });
        
   </script>
{% endblock %}